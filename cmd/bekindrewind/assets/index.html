<html>

<head>
    <title>Be Kind Rewind</title>
    <script src="https://unpkg.com/htmx.org/dist/htmx.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
        integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* GLOBALS */

        html {
            color: white;
            background-color: rgb(37, 37, 37);
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        button {
            background-color: rgba(0, 0, 0, 0);
            color: inherit;
            border: none;
            text-align: center;
            display: inline-block;
        }

        button:hover {
            color: rgba(255, 187, 0, 0.815);
            cursor: pointer;
        }

        button:disabled {
            cursor: not-allowed;
        }

        i {
            background-color: rgba(0, 0, 0, 0);
            color: inherit;
            padding: 3px;
        }

        h1 {
            text-align: center;
        }

        a:link {
            color: lightblue;
        }

        a:visited {
            color: lightpink;
        }

        a:active {
            color: lightgreen;
        }

        strong {
            color: rgba(255, 187, 0, 0.815);
        }

        /* FOOTER */

        #footer {
            background-color: black;
            position: fixed;
            bottom: 0;
            left: 0;
            text-align: center;
            width: 100%;
            font-size: 12px;
            color: white;
        }

        /* NAVBAR */

        #navbar {
            background-color: black;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 46px;
        }

        #navbar button {
            padding: 15px 32px;
            font-size: 16px;
        }

        /* MAIN VIEW */

        #main-view {
            align-items: center;
            justify-items: center;

            position: fixed;
            top: 45px;
            bottom: 35px;
            left: 0;
            right: 0;
            padding-bottom: 15px;

            background-color: rgb(37, 37, 37);
            color: white;
        }

        /* MOVIES VIEW */

        #movies-table-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            justify-content: center;
            align-items: center;
        }

        #movie-filters {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
        }

        .movie-filter {
            margin: 3px;
            border: 1px solid white;
        }

        .movie-filter-input {
            border: none;
            background-color: inherit;
            color: inherit;
        }

        #movies-table {
            overflow-y: auto;
            flex: 1;
            color: inherit;
        }

        #movies-table table {
            border-collapse: collapse;
            color: inherit;
        }

        #movies-table table td {
            padding: 0 5px;
        }

        #movies-table thead th {
            border-bottom: 1px solid white;
            cursor: pointer;
        }

        #movies-table thead th:hover {
            color: rgba(255, 187, 0, 0.815);
        }

        #movies-table tfoot th {
            border-top: 1px solid white;
        }

        #movies-table tbody tr:hover {
            background-color: black;
        }

        /* ADD MOVIE VIEW */

        #add_movie_form_container .invalid-input-message {
            color: brown;
        }

        #add_movie_form_container .movie-form {
            display: flex;
            flex-direction: column;
        }

        #add_movie_form_container .invalid-input {
            border: 1px solid indianred;
        }
    </style>
</head>

<body>
    <div id="navbar" role="navigation" aria-label="main navigation">
        <button title="Movies" hx-get="views/movies" hx-target="#main-view">
            <i class="fas fa-list"></i>
        </button>
        <button title="People" hx-get="views/people" hx-target="#main-view">
            <i class="fas fa-walking"></i>
        </button>
        <button title="Add Movie" hx-get="views/add-movie" hx-target="#main-view">
            <i class="fas fa-plus"></i>
        </button>
        <button title="Import/Export" hx-get="views/data" hx-target="#main-view">
            <i class="fas fa-file-archive"></i>
        </button>
    </div>

    <div id="main-view">
        <h1>Be Kind, Rewind!</h1>
        <p><strong>Be Kind, Rewind!</strong> is a simple movie database application.</p>
        <p>It is written in <strong>Go</strong> and uses the <strong>htmx</strong> library for dynamic
            content loading.</p>
        <p>Select a view from the navigation bar above and <strong>enjoy!</strong></p>
    </div>

    <div id="footer">
        <p><strong>Be Kind, Rewind!</strong> by <a href="https://github.com/markort147">Marco Romano</a>.
            Built with <a href="https://golang.org">Go</a>, enhanced by <a href="https://htmx.org">HTMX</a>. The <a
                href="https://github.com/markort147/bekind">source code</a> is licensed <a
                href="https://opensource.org/license/mit">MIT</a>.</p>
    </div>
</body>

<script>
    // Function to handle the class change on elements with class "verified-input"
    function handleVerifiedInputClassChange() {
        const verifiedInputs = document.querySelectorAll('.verified-input');
        const verifiedButtons = document.querySelectorAll('.verified-button');

        verifiedInputs.forEach(input => {
            // Initial check
            if (input.classList.contains('invalid-input')) {
                verifiedButtons.forEach(button => {
                    button.setAttribute('disabled', 'disabled');
                });
            }

            // Observe class changes
            const observer = new MutationObserver(() => {
                let anyDanger = false;
                verifiedInputs.forEach(input => {
                    if (input.classList.contains('invalid-input')) {
                        anyDanger = true;
                    }
                });

                verifiedButtons.forEach(button => {
                    if (anyDanger) {
                        button.setAttribute('disabled', 'disabled');
                    } else {
                        button.removeAttribute('disabled');
                    }
                });
            });

            observer.observe(input, { attributes: true, attributeFilter: ['class'] });
        });
    }

    // Initialize the class change handler on DOMContentLoaded and htmx:afterSwap
    document.addEventListener('DOMContentLoaded', handleVerifiedInputClassChange);
    document.body.addEventListener('htmx:afterSwap', handleVerifiedInputClassChange);

    // Handle file download for CSV files
    document.addEventListener('htmx:afterRequest', function (evt) {
        const xhr = evt.detail.xhr;
        if (xhr.getResponseHeader('Content-Disposition') === 'attachment' && typeof xhr.getResponseHeader('HX-Download') === 'string') {
            const filename = xhr.getResponseHeader('HX-Download');
            console.log(xhr.response);
            const blob = new Blob([xhr.response], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    });
</script>

</html>