<html>

<head>
    <title>Be Kind Rewind</title>
    <script src="https://unpkg.com/htmx.org/dist/htmx.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
        integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/styles/style.css"/>
</head>

<body>
    <div id="navbar" role="navigation" aria-label="main navigation">
        <button title="Movies" hx-get="views/movies" hx-target="#main-view">
            <i class="fas fa-list"></i>
        </button>
        <button title="People" hx-get="views/people" hx-target="#main-view">
            <i class="fas fa-walking"></i>
        </button>
        <button title="Add Movie" hx-get="views/add-movie" hx-target="#main-view">
            <i class="fas fa-plus"></i>
        </button>
        <button title="Import/Export" hx-get="views/data" hx-target="#main-view">
            <i class="fas fa-file-archive"></i>
        </button>
    </div>

    <div id="main-view">
        <h1>Be Kind, Rewind!</h1>
        <p><strong>Be Kind, Rewind!</strong> is a simple movie database application.</p>
        <p>It is written in <strong>Go</strong> and uses the <strong>htmx</strong> library for dynamic
            content loading.</p>
        <p>Select a view from the navigation bar above and <strong>enjoy!</strong></p>
    </div>

    <div id="footer">
        <p><strong>Be Kind, Rewind!</strong> by <a href="https://github.com/markort147">Marco Romano</a>.
            Built with <a href="https://golang.org">Go</a>, enhanced by <a href="https://htmx.org">HTMX</a>. The <a
                href="https://github.com/markort147/bekind">source code</a> is licensed <a
                href="https://opensource.org/license/mit">MIT</a>.</p>
    </div>
</body>

<script>
    // Function to handle the class change on elements with class "verified-input"
    function handleVerifiedInputClassChange() {
        const verifiedInputs = document.querySelectorAll('.verified-input');
        const verifiedButtons = document.querySelectorAll('.verified-button');

        verifiedInputs.forEach(input => {
            // Initial check
            if (input.classList.contains('invalid-input')) {
                verifiedButtons.forEach(button => {
                    button.setAttribute('disabled', 'disabled');
                });
            }

            // Observe class changes
            const observer = new MutationObserver(() => {
                let anyDanger = false;
                verifiedInputs.forEach(input => {
                    if (input.classList.contains('invalid-input')) {
                        anyDanger = true;
                    }
                });

                verifiedButtons.forEach(button => {
                    if (anyDanger) {
                        button.setAttribute('disabled', 'disabled');
                    } else {
                        button.removeAttribute('disabled');
                    }
                });
            });

            observer.observe(input, { attributes: true, attributeFilter: ['class'] });
        });
    }

    // Initialize the class change handler on DOMContentLoaded and htmx:afterSwap
    document.addEventListener('DOMContentLoaded', handleVerifiedInputClassChange);
    document.body.addEventListener('htmx:afterSwap', handleVerifiedInputClassChange);

    // Handle file download for CSV files
    document.addEventListener('htmx:afterRequest', function (evt) {
        const xhr = evt.detail.xhr;
        if (xhr.getResponseHeader('Content-Disposition') === 'attachment' && typeof xhr.getResponseHeader('HX-Download') === 'string') {
            const filename = xhr.getResponseHeader('HX-Download');
            console.log(xhr.response);
            const blob = new Blob([xhr.response], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    });
</script>

</html>